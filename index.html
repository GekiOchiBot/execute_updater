<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="style.css">
<head>
    <title>execute updater</title>
</head>
<body>
    <h1>execute updater</h1>
    <h2>var.2.0</h2>
    <h2>旧executeを新しい物に変換します。</h2>

    <textarea placeholder="ここに旧executeを入力" style="width: 600px; height: 50px;" id="text"></textarea>
    <p id="p"></p>
    <script>

        let subCommands =[
        "run"
        ]

        let selectors = [
            "@a",
            "@e",
            "@p",
            "@r",
            "@s",
            "@initiator"
        ]


        function split(){

            let p = document.getElementById("p")
            let text = document.getElementById('text').value
            let str = text.split('/').join('');
            str = str.split('~').join(" ~");
            str = str.split('  ').join(' ');
            str = str.split(',').join('@44&$%#&$%&%MaxOfTERRRRaw33');
            str = str.split(' ');
            let out = str

            for (let i = 0; i < str.length; i++) {
                if (subCommands.indexOf(str[i]) != -1) {
                    error("コマンドが新executeです");
                    return;
                }
            }

            var E
            if(text.match(/execute/g)) E = text.match(/execute/g)
            


            const EArray = []
            var EposGet = str.concat()
            if (!E) return;
            for (let i = 0; i < E.length; i++) {
                const Epos = EposGet.indexOf("execute")
                EposGet.splice(Epos,1,"n")
                EArray.splice(EArray.length,0,Epos)
            }


            //繰り返してexecuteを全部正す
            for (let i = 0; i < E.length; i++) {
                //コマンドがexecuteかどうか
                if (str[EArray[i]] == "execute") {
                                if (str[EArray[i] + 2] == "~" && str[EArray[i] + 3] == "~" && str[EArray[i] + 4] == "~") {
                                    out.splice(EArray[i] + 2,3,"run");
                                    out.splice(EArray[i] + 2,0,"at @s");
                                }
                                else{
                                    out.splice(EArray[i] + 2,0,"positioned");
                                    out.splice(EArray[i] + 6,0,"run");
                                }
                                out.splice(EArray[i] + 1,0,"as");
                                if (str[EArray[i] + 2].indexOf("~") != -1 || str[EArray[i] + 3].indexOf("~") != -1 || str[EArray[i] + 4].indexOf("~") != -1) out.splice(EArray[i] + 3,0,"at @s");


                                const runPos = out.indexOf('run',EArray[i])
                                const translate = 0
                                if (EArray[i] != 0) {
                                    out.splice(EArray[i] - 1,2,"")
                                    if (str[runPos] == "detect") {
                                        out.splice(runPos-1,2,"if block")
                                        out.splice(runPos + 6,0,"run")
                                    }
                                }
                                if (str[runPos + 1] == "detect" && EArray[i] == 0) {
                                    out.splice(runPos,2,"if block")
                                    out.splice(runPos + 6,0,"run")
                                }


                                success(out)
                            

                    }
                else {
                    error("コマンドがexecuteではありません")
                    return;
                }
            }
            

        }

        function success(str){
            text = str.toString()
            text = text.split(',').join(' ')
            text = text.split('@44&$%#&$%&%MaxOfTERRRRaw33').join(',')
            p.innerText = text
        }

        function error(ertext){
            p.innerText = ertext
        }

        window.onload = function(){
            setInterval(() =>{
                split()
            }, 10);

        }
    </script>
</body>
